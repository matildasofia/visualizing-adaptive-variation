!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).createPubSub={})}(this,(function(e){"use strict";var n=function(){try{return new window.BroadcastChannel("pub-sub-es")}catch(e){return{postMessage:function(){}}}}(),t=function(e,n){return n?e.toLowerCase():e},s=function(e,n){void 0===n&&(n={});var s=n.caseInsensitive;return function(n,i,o){void 0===o&&(o=1/0);var a=t(n,s);return e[a]||(e[a]=[],e.__times__[a]=[]),e[a].push(i),e.__times__[a].push(+o||1/0),{event:a,handler:i}}},i=function(e,n){void 0===n&&(n={});var s=n.caseInsensitive;return function(n,i){"object"==typeof n&&(i=n.handler,n=n.event);var o=t(n,s);if(e[o]){var a=e[o].indexOf(i);-1===a||a>=e[o].length||(e[o].splice(a,1),e.__times__[o].splice(a,1))}}},o=function(e,n){return function(){e.forEach((function(e){return e(n)}))}},a=function(e,s){void 0===s&&(s={});var a=s.isGlobal,c=s.caseInsensitive,r=s.async,u=i(e);return function(s,i,f){void 0===f&&(f={});var _=t(s,c);if(e[_]){var l=[].concat(e[_]);if(l.forEach((function(n,t){--e.__times__[_][t]<1&&u(_,n)})),r||f.async?setTimeout(o(l,i),0):o(l,i)(),a&&!f.isNoGlobalBroadcast)try{n.postMessage({event:_,news:i})}catch(e){if(!(e instanceof DOMException))throw e;console.warn("Could not broadcast '"+_+"' globally. Payload is not clonable.")}}}},c=function(e){return function(){Object.keys(e).filter((function(e){return"_"!==e[0]})).forEach((function(n){e[n]=void 0,e.__times__[n]=void 0,delete e[n],delete e.__times__[n]}))}},r=function(e){void 0===e&&(e={});var n=e.async||!1,t=e.caseInsensitive||!1,o=e.stack||{__times__:{}};return o.__times__||(o.__times__={}),{publish:a(o,{async:n,caseInsensitive:t}),subscribe:s(o,{caseInsensitive:t}),unsubscribe:i(o,{caseInsensitive:t}),clear:c(o),stack:o}},u={__times__:{}},f={publish:a(u,{isGlobal:!0}),subscribe:s(u),unsubscribe:i(u),clear:c(u),stack:u};n.onmessage=function(e){var n=e.data,t=n.event,s=n.news;return f.publish(t,s,{isNoGlobalBroadcast:!0})},e.createPubSub=r,e.default=r,e.globalPubSub=f,Object.defineProperty(e,"__esModule",{value:!0})}));
